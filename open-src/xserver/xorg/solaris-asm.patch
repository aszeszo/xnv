From 97f2f54b44f4fe28973a15d17eede98137cef689 Mon Sep 17 00:00:00 2001
From: David Marx <David.Marx@Sun.COM>
Date: Wed, 13 May 2009 17:53:30 -0700
Subject: [PATCH] Solaris: Make sure non-inline versions of asm routines end with ret statements

Signed-off-by: Alan Coopersmith <alan.coopersmith@sun.com>
---
 hw/xfree86/os-support/solaris/solaris-amd64.S      |    2 +-
 hw/xfree86/os-support/solaris/solaris-ia32.S       |    2 +-
 .../os-support/solaris/solaris-sparcv8plus.S       |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/hw/xfree86/os-support/solaris/solaris-amd64.S b/hw/xfree86/os-support/solaris/solaris-amd64.S
index 9f5e58c..4a0e0f4 100644
--- a/hw/xfree86/os-support/solaris/solaris-amd64.S
+++ b/hw/xfree86/os-support/solaris/solaris-amd64.S
@@ -32,7 +32,7 @@
 #define _ASM
 #include <sys/asm_linkage.h>
 #define FUNCTION_START(f,n)	ENTRY(f)
-#define FUNCTION_END(f)		SET_SIZE(f)
+#define FUNCTION_END(f)		ret; SET_SIZE(f)
 #endif
 
 	FUNCTION_START(inb,4)
diff --git a/hw/xfree86/os-support/solaris/solaris-ia32.S b/hw/xfree86/os-support/solaris/solaris-ia32.S
index e2d9cf6..280154b 100644
--- a/hw/xfree86/os-support/solaris/solaris-ia32.S
+++ b/hw/xfree86/os-support/solaris/solaris-ia32.S
@@ -32,7 +32,7 @@
 #define _ASM
 #include <sys/asm_linkage.h>
 #define FUNCTION_START(f,n)	ENTRY(f)
-#define FUNCTION_END(f)		SET_SIZE(f)
+#define FUNCTION_END(f)		ret; SET_SIZE(f)
 #endif
 
 	FUNCTION_START(inb,4)
diff --git a/hw/xfree86/os-support/solaris/solaris-sparcv8plus.S b/hw/xfree86/os-support/solaris/solaris-sparcv8plus.S
index fb23942..dbaa030 100644
--- a/hw/xfree86/os-support/solaris/solaris-sparcv8plus.S
+++ b/hw/xfree86/os-support/solaris/solaris-sparcv8plus.S
@@ -33,7 +33,7 @@
 #define _ASM
 #include <sys/asm_linkage.h>
 #define FUNCTION_START(f,n)	ENTRY(f)
-#define FUNCTION_END(f)		SET_SIZE(f)
+#define FUNCTION_END(f)		retl; nop; SET_SIZE(f)
 #endif
 
 /* Converted from common/compiler.h gcc inline format to Sun cc inline
-- 
1.5.6.5

