# Copyright 2007 Sun Microsystems, Inc.  All rights reserved.
# Use subject to license terms.
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the
# "Software"), to deal in the Software without restriction, including
# without limitation the rights to use, copy, modify, merge, publish,
# distribute, and/or sell copies of the Software, and to permit persons
# to whom the Software is furnished to do so, provided that the above
# copyright notice(s) and this permission notice appear in all copies of
# the Software and that both the above copyright notice(s) and this
# permission notice appear in supporting documentation.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT
# OF THIRD PARTY RIGHTS. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
# HOLDERS INCLUDED IN THIS NOTICE BE LIABLE FOR ANY CLAIM, OR ANY SPECIAL
# INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER RESULTING
# FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,
# NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION
# WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
# 
# Except as contained in this notice, the name of a copyright holder
# shall not be used in advertising or otherwise to promote the sale, use
# or other dealings in this Software without prior written authorization
# of the copyright holder.

diff -u hw/xfree86/common/xf86Configure.c hw/xfree86/common/xf86Configure.c
--- hw/xfree86/common/xf86Configure.c	2006-10-11 15:42:19.000000000 -0700
+++ hw/xfree86/common/xf86Configure.c	2007-04-17 10:58:40.734088000 -0700
@@ -641,7 +641,8 @@
             /* Add only those font backends which are referenced by fontpath */
             /* 'strstr(dFP,"/dir")' is meant as 'dFP =~ m(/dir\W)' */
     	    if (defaultFontPath && (
-		(strcmp(*el, "freetype")  == 0 &&
+		(((strcmp(*el, "bitstream") == 0) ||
+		  (strcmp(*el, "freetype")  == 0)) &&
  		 (strstr(defaultFontPath, "/TrueType") ||
  		  strstr(defaultFontPath, "/TTF"))) ||
     	        (strcmp(*el, "type1")  == 0 &&

--- hw/xfree86/dixmods/Makefile.am	2007-06-28 15:24:42.319069000 -0700
+++ hw/xfree86/dixmods/Makefile.am	2007-06-28 16:39:20.990865000 -0700
@@ -103,6 +103,13 @@
 libxtrap_la_LIBADD = $(top_builddir)/XTrap/libxtrap.la
 libxtrap_la_SOURCES = xf86XTrapModule.c
 
+# bitstream -> freetype mapping module for compatibility with old conf files
+fontsmodule_LTLIBRARIES += libbitstream.la 
+libbitstream_la_LDFLAGS = -avoid-version
+libbitstream_la_SOURCES = btmodule.c
+
+btmodule.c: ftmodule.c
+	sed -e s/\"freetype\"/\"bitstream\"/ ftmodule.c > btmodule.c
 
 # Sun IA extension module additions
 extsmodule_LTLIBRARIES += libIA.la
