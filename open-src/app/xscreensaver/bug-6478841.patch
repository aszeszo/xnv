/*
 * Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, and/or sell copies of the Software, and to permit persons
 * to whom the Software is furnished to do so, provided that the above
 * copyright notice(s) and this permission notice appear in all copies of
 * the Software and that both the above copyright notice(s) and this
 * permission notice appear in supporting documentation.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT
 * OF THIRD PARTY RIGHTS. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 * HOLDERS INCLUDED IN THIS NOTICE BE LIABLE FOR ANY CLAIM, OR ANY SPECIAL
 * INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER RESULTING
 * FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,
 * NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION
 * WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * Except as contained in this notice, the name of a copyright holder
 * shall not be used in advertising or otherwise to promote the sale, use
 * or other dealings in this Software without prior written authorization
 * of the copyright holder.
 *
 */

diff -urp -x '*~' driver/xscreensaver.c driver~/xscreensaver.c
--- driver/xscreensaver.c	2006-10-06 12:44:30.982326000 -0700
+++ driver~/xscreensaver.c	2006-10-20 11:05:39.904940000 -0700
@@ -749,6 +749,7 @@ print_banner (saver_info *si)
     }
 }
 
+#define SZ_MAXBUF	20
 
 /* Examine all of the display's screens, and populate the `saver_screen_info'
    structures.  Make sure this is called after hack_environment() sets $PATH.
@@ -758,6 +759,21 @@ initialize_per_screen_info (saver_info *
 {
   Bool found_any_writable_cells = False;
   int i;
+/*
+** 6478841: hard-coded display number in screensaver
+** it needs to support SR full screen mag wiht dual heads under
+** a certain SR policy condition
+*/
+
+  char *dpystring = NULL;
+  char *dpytail = NULL;
+  char *dpytoken = NULL;
+
+  dpystring =  DisplayString(si->dpy);	
+  if (dpystring)
+	dpytail = (char *) strrchr(dpystring,':'); /* IPV6 ? */
+  if (dpytail)
+	dpytoken = strtok(dpytail,"\\." );
 
   si->nscreens = ScreenCount(si->dpy);
   si->screens = (saver_screen_info *)
@@ -814,12 +830,12 @@ initialize_per_screen_info (saver_info *
 */
         if (i > 0)       /* other screens */
         {
-        char other_dpyname[20];
-        char *pdpy;
-	sprintf(other_dpyname,":0.%d\0",i);
-	pdpy = strdup(other_dpyname);
-        ssi->other_dpy = XOpenDisplay(pdpy);
-	free(pdpy);
+        char other_dpyname[SZ_MAXBUF];
+	if (dpytoken)
+		snprintf(other_dpyname,SZ_MAXBUF,"%s.%d",dpytoken,i);
+	else
+		snprintf(other_dpyname,SZ_MAXBUF,":0.%d",i);
+        ssi->other_dpy = XOpenDisplay(other_dpyname);
 /*
 fprintf(stderr,"==>other dpy i(%d) dpy(%s) 0x%x\n",i,other_dpyname, ssi->other_dpy);
 */
