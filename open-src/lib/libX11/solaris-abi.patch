###############################################################################
# Copyright 2008 Sun Microsystems, Inc.  All rights reserved.
# Use subject to license terms.
#
# Permission is hereby granted, free of charge, to any person obtaining a
# copy of this software and associated documentation files (the
# "Software"), to deal in the Software without restriction, including
# without limitation the rights to use, copy, modify, merge, publish,
# distribute, and/or sell copies of the Software, and to permit persons
# to whom the Software is furnished to do so, provided that the above
# copyright notice(s) and this permission notice appear in all copies of
# the Software and that both the above copyright notice(s) and this
# permission notice appear in supporting documentation.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT
# OF THIRD PARTY RIGHTS. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
# HOLDERS INCLUDED IN THIS NOTICE BE LIABLE FOR ANY CLAIM, OR ANY SPECIAL
# INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER RESULTING
# FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,
# NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION
# WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
# 
# Except as contained in this notice, the name of a copyright holder
# shall not be used in advertising or otherwise to promote the sale, use
# or other dealings in this Software without prior written authorization
# of the copyright holder.
#
diff -urp -x '*~' -x '*.orig' configure.ac configure.ac
--- configure.ac	2009-04-07 15:18:30.000000000 -0700
+++ configure.ac	2009-04-08 00:18:15.093686000 -0700
@@ -138,7 +138,7 @@ if test x$XLIB_LOADABLE_I18N = xyes; the
 	fi
 	AC_DEFINE(USE_DYNAMIC_LC,1,
 		  [Split some i18n functions into loadable modules])
-	AC_SUBST(I18N_MODULE_LIBS,'${top_builddir}/src/libX11.la')
+	AC_SUBST(I18N_MODULE_LIBS,'${top_builddir}/src/libX11.so.4 -lc')
 fi
 AC_MSG_RESULT($XLIB_LOADABLE_I18N)
 
diff -urp -x '*~' -x '*.orig' src/Makefile.am src/Makefile.am
--- src/Makefile.am	2008-11-18 22:42:01.000000000 -0800
+++ src/Makefile.am	2009-04-08 00:18:15.094065000 -0700
@@ -373,9 +373,13 @@ if XKB
 USE_XKB_LIBS = $(XKB_LIBS)
 endif
 
-libX11_la_LDFLAGS = -version-number 6:2:0 -no-undefined
+libX11_la_LDFLAGS = -version-number 4 -no-undefined $(ADD_libX11_LDFLAGS) \
+	-M $(top_srcdir)/../../mapfile-vers \
+	-M $(top_srcdir)/../../mapfile-order \
+	-N libXext.so.0
 
 libX11_la_LIBADD = \
+	-lc \
 	$(USE_I18N_LIBS) \
 	$(USE_XCMS_LIBS) \
 	$(USE_XKB_LIBS) \
